query CollectionPage(
  $locale: String!,
  $identifier: String!,
  $linkGroups: Boolean = true,
  $preview: Boolean = false
) {
  mainNavigation: linkGroupCollection(preview: $preview, locale: $locale, limit: 1, where: { identifier: "mainNavigation" }) @include(if: $linkGroups) {
    ...linkGroupFields
  }
  footerMoreInfo: linkGroupCollection(preview: $preview, locale: $locale, limit: 1, where: { identifier: "footerMoreInfo" }) @include(if: $linkGroups) {
    ...linkGroupFields
  }
  footerHelp: linkGroupCollection(preview: $preview, locale: $locale, limit: 1, where: { identifier: "footerHelp" }) @include(if: $linkGroups) {
    ...linkGroupFields
  }
  entityPage: entityPageCollection(limit: 1, where: { identifier: $identifier }) {
    items {
      name
      description
      identifier
      genre
      primaryImageOfPage {
        url
        image {
          url
          contentType
        }
      }
      relatedLinksCollection(limit: 4) {
        items {
        	identifier
          name
          slug
          description
          image
        }
      }
      hasPartCollection(limit: 20) {
        items {
          __typename
          ... on ContentTypeRichText {
            text
          }
          ... on CardGroup {
            headline
          	text
            # TODO: reduce this limit in CTF content model?
            hasPartCollection(limit: 60) {
              items {
                __typename
                ... on AutomatedEntityCard {
                  name
                  identifier
                  description
                  slug
                  entityImage: image
                }
                ... on AutomatedRecordCard {
                  identifier
                  encoding
                }
                ... on CuratedCard {
                  name
                  description
                  url
                  image {
                    url
                    contentType
                  }
                }
              }
            }
            moreButton {
              url
              text
            }
        	}
        }
      }
    }
  }
  curatedEntities: entityPageCollection(preview: $preview, locale: $locale, limit: 1000) {
    items {
      name
      identifier
      genre
    }
  }
}

fragment linkGroupFields on LinkGroupCollection {
  items {
    identifier
    name
    links: linksCollection(limit: 10) {
      items {
        text
        url
      }
    }
  }
}
